{% load quote_filters %}
{% load static %}

      <div class="pq-quote">
            
            
            {% if is_episode_page or is_quote_page %}
            {% else %}
                <div class="pq-quote-breadcrumbs">
                      {% if is_home_page %}
                          {% if quote.episode.podcast.title %}
                              <a href="{% url 'podcast_quote_list' pk=quote.episode.podcast.id query_filter='hot' %}">
                                  {{ quote.episode.podcast.title }}
                              </a>
                              >
                          {% endif %}
                      {% endif %}
                      
                      {% if is_home_page or is_podcast_page %}
                          {% if quote.episode.title %} 
                              <a href="{% url 'episode_quote_list' pk=quote.episode.id query_filter='hot' %}">
                                  {{ quote.episode.title }}
                              </a>
                          {% endif %}
                      {% endif %}
                </div>
            {% endif %}
            
            <div class="pq-quote-buttons hidden-xs hidden-sm hidden-md">
                
            <form method="post" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-upvote {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-upvote-{{ quote.id }}" title="Please login to vote">
                            <i class="fa fa-arrow-up"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-upvote {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-upvote-{{ quote.id }}">
                            <i class="fa fa-arrow-up"></i>
                    </button>
                {% endif %}
            </form>

                <div class="pq-quote-vote-total" id="pq-quote-vote-total-{{ quote.id }}">
                    {{ quote.vote_score }}
                </div>
                
            <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="-1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-downvote {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-downvote-{{ quote.id }}" title="Please login to vote">
                            <i class="fa fa-arrow-down"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-downvote {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-downvote-{{ quote.id }}">
                            <i class="fa fa-arrow-down"></i>
                    </button>
                {% endif %}
            </form>
                
            </div><!-- /.pq-quote-buttons hidden-xs hidden-sm hidden-md -->
        
        <div class="pq-quote-player" id="pq-quote-player-{{ forloop.counter }}">
        
            {% if quote.time_quote_begins and quote.episode.youtube_url %}
                
                <div class="youtube-box" id="youtube-{{ forloop.counter }}">
                  <div class="youtube" id="{{ quote.episode.video_id }}?rel=0&vq=small&start={{ quote.time_quote_begins }}&end={{ quote.time_quote_ends }}&autoplay=1&modestbranding=1&showinfo=0&fs=1">
                  </div>
                </div>

            {% endif %}       
            
        </div><!-- /.pq-quote-player -->
        
        <div class="pq-quote-text-wrapper" id="quote-text-wrapper-{{ forloop.counter }}">
        
            {% if quote.summary %}
                <div class="pq-quote-summary">
                    <a href="{{ quote.get_absolute_url }}">{{ quote.summary }}</a>
                </div><!-- /.pq-quote-summary -->
            {% endif %}
            
            {% if is_episode_page or is_quote_page %}
            {% else %}
                
            {% endif %}
        
        <div class="pq-quote-xs-buttons hidden-lg">
            <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-xs-upvote {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-xs-upvote-{{ quote.id }}" title="Please login to vote">
                            <i class="fa fa-arrow-up"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-xs-upvote {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-xs-upvote-{{ quote.id }}">
                            <i class="fa fa-arrow-up"></i>
                    </button>
                {% endif %}
            </form>
            
            <div class="pq-quote-xs-vote-total" id="pq-quote-xs-vote-total-{{ quote.id }}">
                {{ quote.vote_score }}
            </div>
            
            <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="-1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-xs-downvote {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-xs-downvote-{{ quote.id }}" title="Please login to vote">
                            <i class="fa fa-arrow-down"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-xs-downvote {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-xs-downvote-{{ quote.id }}">
                            <i class="fa fa-arrow-down"></i>
                    </button>
                {% endif %}
            </form>
        </div><!-- /.pq-quote-xs-buttons -->
        
        {% if is_home_page or is_podcast_page or is_episode_page %}
            <div class="pq-quote-text-box">
                {% if quote.text %}
                    <div class="pq-quote-text-preview" id="pq-quote-text-preview-{{ forloop.counter }}">
                      {{ quote.text|linebreaks|truncatechars:200 }}
                        {% if quote.is_longer_than_200chars %}
                            <span class="pq-show-more" id="show-more-{{ forloop.counter }}">
                                show
                            </span>
                        {% endif %}
                    </div>

                    <div class="pq-quote-text" id="pq-quote-text-{{ forloop.counter }}">
                      {{ quote.text|linebreaks }}
                        {% if quote.is_longer_than_200chars %}
                            <div class="pq-show-less" id="show-less-{{ forloop.counter }}">
                                hide
                            </div>
                        {% endif %}
                    </div><!-- /.pq-quote-text -->
                {% endif %}
            </div><!-- /.pq-quote-text-box -->
            {% endif %}
            
            {% if is_quote_page %}
                {% if quote.text %}
                    <div class="pq-quote-text-box">
                        {{ quote.text|linebreaks }}
                    </div>
                {% endif %}
            {% endif %}

        <script>
          $("#show-more-{{ forloop.counter }}").click(function() {
              $("#pq-quote-text-{{ forloop.counter }}").show();
              $("#pq-quote-text-preview-{{ forloop.counter }}").hide();
              $("#show-more-{{ forloop.counter }}").hide();
              $("#show-less-{{ forloop.counter }}").show();
          });
          $("#show-less-{{ forloop.counter }}").click(function() {
              $("#pq-quote-text-preview-{{ forloop.counter }}").show();
              $("#pq-quote-text-{{ forloop.counter }}").hide();
              $("#show-less-{{ forloop.counter }}").hide();
              $("#show-more-{{ forloop.counter }}").show();
          });
          $("#youtube-{{ forloop.counter }}").click(function() {
              $("#preview-published-{{ forloop.counter }}").hide();
              $("#youtube-podcast-logo-{{ forloop.counter }}").hide();
              $("#preview-time-{{ forloop.counter }}").hide();
              $("#pq-quote-player-{{ forloop.counter }}").toggleClass('pull-left')
              $("#pq-quote-player-{{ forloop.counter }}").css('margin-left','0')
              $("#quote-text-wrapper-{{ forloop.counter }}").toggleClass('overflow-none');
          });
        </script>
          
          <div class="pq-quote-date">
              {% if is_home_page or is_podcast_page %} 
                  {{ quote.episode.publication_date|date:'M d, Y' }} -
              {% endif %}
                  {{ quote.converted_time_begins }} 
              {% if quote.time_quote_ends %}
                  - {{ quote.converted_time_ends }}
              {% endif %}
          </div>
          
          {% if is_quote_page %}
            <div class="pq-quote-posted-by">
                posted 4 hours ago by {{ quote.submitted_by }}
            </div>
          {% endif %}

        
          <div class="pq-quote-bottom-buttons">
          
          <!-- Button trigger modal -->
          <button class="pq-quote-bottom-button" data-toggle="modal" data-target="#quoteShareModal{{ quote.id }}">
            share
          </button>
          
          <!-- Modal -->
          <div class="modal fade" id="quoteShareModal{{ quote.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title" id="myModalLabel">Copy this link</h4>
                </div>
                <div class="modal-body">
                    http://www.podcastquotes.com{{ quote.get_absolute_url }}
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div><!-- /.modal fade -->
            
            {% if quote.episode.podcast.donate_url or quote.episode.donate_url %}
                <div class="pq-quote-bottom-button text-orange">
                    <a href=
                    "{% if quote.episode.donate_url %}
                        {{ quote.episode.donate_url }}
                    {% else %}
                        {{ quote.episode.podcast.donate_url }}
                    {% endif %}"
                    target="_blank">
                        donate
                    </a>
                </div>
            {% endif %}
              <div class="clearfix">
              </div>
            
          </div><!-- /.pq-quote-bottom -->
        
        </div><!-- /.pq-quote-text-wrapper -->
        
        <div class="clearfix">
        </div>

      </div><!-- /.pq-quote hidden-xs visible-sm visible-md visible-lg -->