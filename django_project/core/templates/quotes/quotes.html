{% load quote_filters %}
{% load static %}

<div class="pq-quote">
    
    <div class="pq-quote-buttons">
        
        <form method="post" action="{% url 'quote_vote' %}" class="vote_form">
            {% csrf_token %}
            <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
            <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
            <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="1" />
            {% if not user.is_authenticated %}
                <button disabled class="pq-quote-upvote gray-gradient {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-upvote-{{ quote.id }}" title="Please login to vote">
                    <i class="fa fa-arrow-up"></i>
                </button>
            {% else %}
                <button class="pq-quote-upvote gray-gradient {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-upvote-{{ quote.id }}">
                    <i class="fa fa-arrow-up"></i>
                </button>
            {% endif %}
        </form>

        <div class="pq-quote-vote-total" id="pq-quote-vote-total-{{ quote.id }}">
            {{ quote.vote_score }}
        </div>
        
        <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
            {% csrf_token %}
            <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
            <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
            <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="-1" />
            {% if not user.is_authenticated %}
                <button disabled class="pq-quote-downvote gray-gradient {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-downvote-{{ quote.id }}" title="Please login to vote">
                        <i class="fa fa-arrow-down"></i>
                </button>
            {% else %}
                <button class="pq-quote-downvote gray-gradient {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-downvote-{{ quote.id }}">
                        <i class="fa fa-arrow-down"></i>
                </button>
            {% endif %}
        </form>
        
    </div><!-- /.pq-quote-buttons -->
    
    <div class="pq-quote-text-wrapper" id="quote-text-wrapper-{{ forloop.counter }}">
        <div class="pq-quote-title dark-link">
            {% if quote.summary %}
                <a href="{{ quote.get_absolute_url }}">
                    {{ quote.summary }}
                </a>
            {% elif not quote.summary %}
                <a href="{{ quote.get_absolute_url }}">
                    {{ quote.converted_time_begins }} to {{ quote.converted_time_ends }}
                </a>
            {% endif %}
        </div>
        
        {% if is_episode_page %}
        {% else %}
            {% if is_home_page or is_quote_page or is_user_page %}
                {% if quote.episode.podcast.image %}
                    <div class="pq-quote-profile-picture">
                        <a href="{% url 'podcast_quote_list_root' pk=quote.episode.podcast.id %}">
                            <img src="/media/{{ quote.episode.podcast.image }}">
                        </a>
                    </div>
                {% endif %}
            {% endif %}
        
            <div class="pq-quote-subtitle gray-link">
                {% if is_home_page or is_quote_page or is_user_page %}
                    {% if quote.episode.podcast.title %}
                        <a href="{% url 'podcast_quote_list_root' pk=quote.episode.podcast.id %}">
                            Podcast: {{ quote.episode.podcast.title|truncatechars:36 }}
                        </a>
                        <br>
                    {% endif %}
                {% endif %}
                
                {% if is_home_page or is_podcast_page or is_quote_page or is_user_page %}
                    {% if quote.episode.title %} 
                        <a href="{% url 'episode_quote_list' pk=quote.episode.id query_filter='hot' %}">
                           Episode: {{ quote.episode.title|truncatechars:36 }}
                        </a>
                    {% endif %}
                {% endif %}
            </div>
        {% endif %}
        
        <div class="youtube-start-button-wrapper" id="youtube-start-button-wrapper-{{ forloop.counter }}">
            {% if quote.time_quote_begins and quote.episode.youtube_url %}    
                <div class="youtube-start-button fa fa-play light-blue-gradient" id="{{ quote.episode.video_id }}?rel=0&vq=small&start={{ quote.time_quote_begins }}&end={{ quote.time_quote_ends }}&autoplay=1&modestbranding=1&showinfo=0&fs=1">
                    <div class="youtube-start-button-text" id="{{ forloop.counter }}">
                        <small>&nbsp</small> PLAY
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div class="youtube-player-wrapper" id="youtube-player-wrapper-{{ forloop.counter }}">
        <!-- Insert video onclick of youtube-start-button-wrapper via youtube.js -->
        </div>
        
        {% if is_home_page or is_podcast_page or is_episode_page or is_user_page %}
            <div class="pq-quote-text-box" {% if not quote.episode.youtube_url %}style="margin-top:15px"{% endif %}>
                {% if quote.text %}
                    <div class="pq-quote-text-preview" id="pq-quote-text-preview-{{ forloop.counter }}">
                      {{ quote.text|linebreaks|truncatechars:400 }}
                        {% if quote.is_longer_than_400chars %}
                            <span class="pq-show-more" id="show-more-{{ forloop.counter }}">
                                show
                            </span>
                        {% endif %}
                    </div>
                    <div class="pq-quote-text" id="pq-quote-text-{{ forloop.counter }}">
                      {{ quote.text|linebreaks }}
                        {% if quote.is_longer_than_400chars %}
                            <div class="pq-show-less" id="show-less-{{ forloop.counter }}">
                                hide
                            </div>
                        {% endif %}
                    </div><!-- /.pq-quote-text -->
                {% endif %}
            </div><!-- /.pq-quote-text-box -->
        {% endif %}
        
        {% if is_quote_page %}
            {% if quote.text %}
                <div class="pq-quote-text-box">
                    {{ quote.text|linebreaks }}
                </div>
            {% endif %}
        {% endif %}
    
        <div class="pq-quote-xs-buttons hidden-sm hidden-md hidden-lg">
            <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-xs-upvote gray-gradient {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-xs-upvote-{{ quote.id }}" title="Please login to vote">
                        <i class="fa fa-arrow-up"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-xs-upvote gray-gradient {{ quote.id | class_if_upvote_active:user.id }}" id="pq-quote-xs-upvote-{{ quote.id }}">
                        <i class="fa fa-arrow-up"></i>
                    </button>
                {% endif %}
            </form>
            
            <div class="pq-quote-xs-vote-total" id="pq-quote-xs-vote-total-{{ quote.id }}">
                {{ quote.vote_score }}
            </div>
            
            <form method="POST" action="{% url 'quote_vote' %}" class="vote_form">
                {% csrf_token %}
                <input type="hidden" id="id_quote" name="quote" class="hidden_id" value="{{ quote.pk }}" />
                <input type="hidden" id="id_voter" name="voter" class="hidden_id" value="{{ user.pk }}" />
                <input type="hidden" id="id_vote_type" name="vote_type" class="hidden_id" value="-1" />
                {% if not user.is_authenticated %}
                    <button disabled class="pq-quote-xs-downvote gray-gradient {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-xs-downvote-{{ quote.id }}" title="Please login to vote">
                        <i class="fa fa-arrow-down"></i>
                    </button>
                {% else %}
                    <button class="pq-quote-xs-downvote gray-gradient {{ quote.id | class_if_downvote_active:user.id }}" id="pq-quote-xs-downvote-{{ quote.id }}">
                        <i class="fa fa-arrow-down"></i>
                    </button>
                {% endif %}
            </form>
            
        </div><!-- /.pq-quote-xs-buttons -->
    
        <script>
          $("#show-more-{{ forloop.counter }}").click(function() {
              $("#pq-quote-text-{{ forloop.counter }}").show();
              $("#pq-quote-text-preview-{{ forloop.counter }}").hide();
              $("#show-more-{{ forloop.counter }}").hide();
              $("#show-less-{{ forloop.counter }}").show();
          });
          $("#show-less-{{ forloop.counter }}").click(function() {
              $("#pq-quote-text-preview-{{ forloop.counter }}").show();
              $("#pq-quote-text-{{ forloop.counter }}").hide();
              $("#show-less-{{ forloop.counter }}").hide();
              $("#show-more-{{ forloop.counter }}").show();
          });
        </script>
    
        {% if is_quote_page %}
            <div class="pq-quote-posted-by blue-link">
                posted 4 hours ago by <a href="{{ quote.submitted_by.userprofile.get_absolute_url }}">{{ quote.submitted_by }}</a>
            </div>
        {% endif %}

        <div class="pq-quote-date dark-link">
            <a href="{{ quote.get_absolute_url }}">
                {% if is_home_page or is_podcast_page %} 
                    {{ quote.episode.publication_date|date:'M d, Y' }} -
                {% endif %}
                    {{ quote.converted_time_begins }} 
                {% if quote.time_quote_ends %}
                    - {{ quote.converted_time_ends }}
                {% endif %}
            </a>
        </div>
  
        <div class="pq-quote-bottom-buttons">
        
            <!-- Button trigger modal -->
            
            <button class="pq-quote-bottom-button" data-toggle="modal" data-target="#quoteShareModal{{ quote.id }}">
                share
            </button>
            
            
            <!-- Modal -->
            <div class="modal fade" id="quoteShareModal{{ quote.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">Copy this link</h4>
                        </div>
                        <div class="modal-body">
                            http://www.podcastquotes.com{{ quote.get_absolute_url }}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal fade -->
            
            {% if is_home_page or is_podcast_page or is_quote_page or is_user_page %}
                {% if quote.episode.donate_url %}
                    <div class="pq-quote-bottom-button text-orange">
                        <a href=
                        "{% if quote.episode.donate_url %}
                            {{ quote.episode.donate_url }}
                        {% endif %}"
                        target="_blank">
                            support
                        </a>
                    </div>
                {% endif %}
            {% endif %}
            
            {% if request.user == quote.submitted_by or user.is_superuser %}
                <div class="pq-quote-bottom-button text-purple">
                    <a href="{{ quote.get_absolute_url }}edit/">
                        edit quote
                    </a>
                </div>
            {% endif %}

            <div class="clearfix">
            </div>
              
        </div><!-- /.pq-quote-bottom -->
  
    </div><!-- /.pq-quote-text-wrapper --> 
  
    <div class="clearfix">
    </div>

</div><!-- /.pq-quote -->